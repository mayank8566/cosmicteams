(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[992],{255:(e,t,s)=>{"use strict";function a(e){let{moduleIds:t}=e;return null}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadChunks",{enumerable:!0,get:function(){return a}}),s(5155),s(7650),s(5744),s(589)},1584:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});var a=s(5155);let r=(0,s(5028).default)(()=>Promise.all([s.e(766),s.e(874),s.e(615)]).then(s.bind(s,4615)),{loadableGenerated:{webpack:()=>[4615]},ssr:!1});function n(){return(0,a.jsx)(r,{})}},2146:(e,t,s)=>{"use strict";function a(e){let{reason:t,children:s}=e;return s}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return a}}),s(5262)},4054:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var s in t)Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}(t,{bindSnapshot:function(){return l},createAsyncLocalStorage:function(){return n},createSnapshot:function(){return o}});let s=Object.defineProperty(Error("Invariant: AsyncLocalStorage accessed in runtime where it is not available"),"__NEXT_ERROR_CODE",{value:"E504",enumerable:!1,configurable:!0});class a{disable(){throw s}getStore(){}run(){throw s}exit(){throw s}enterWith(){throw s}static bind(e){return e}}let r="undefined"!=typeof globalThis&&globalThis.AsyncLocalStorage;function n(){return r?new r:new a}function l(e){return r?r.bind(e):a.bind(e)}function o(){return r?r.snapshot():function(e,...t){return e(...t)}}},4340:(e,t,s)=>{Promise.resolve().then(s.bind(s,9820))},5028:(e,t,s)=>{"use strict";s.d(t,{default:()=>r.a});var a=s(6645),r=s.n(a)},5695:(e,t,s)=>{"use strict";var a=s(8999);s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}})},5744:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorage",{enumerable:!0,get:function(){return a.workAsyncStorageInstance}});let a=s(7828)},5928:(e,t,s)=>{"use strict";s.d(t,{A:()=>c,O:()=>d});var a=s(5155),r=s(2115),n=s(6203),l=s(6104),o=s(5317);let i=(0,r.createContext)(null);function c(){let e=(0,r.useContext)(i);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}function d(e){let{children:t}=e,[s,c]=(0,r.useState)(null),[d,u]=(0,r.useState)(!0);(0,r.useEffect)(()=>{let e=(0,n.hg)(l.j2,e=>{c(e),u(!1)});return(0,n.Q4)(l.j2).then(e=>{(null==e?void 0:e.user)&&c(e.user)}).catch(e=>{}),e},[]);let m=async(e,t,s)=>{let a=await (0,n.eJ)(l.j2,e,t),r=a.user;return s&&r&&(await (0,n.r7)(r,{displayName:s}),await (0,o.BN)((0,o.H9)(l.db,"userProfiles",r.uid),{email:r.email,username:s,displayName:s,createdAt:(0,o.O5)(),hasSetUsername:!0})),a},p=async()=>{try{l.hJ.setCustomParameters({prompt:"select_account"});let t=await (0,n.df)(l.j2,l.hJ,n.hk),s=t.user;if(s){var e;await (0,o.BN)((0,o.H9)(l.db,"userProfiles",s.uid),{email:s.email,displayName:s.displayName||(null===(e=s.email)||void 0===e?void 0:e.split("@")[0])||"User",photoURL:s.photoURL,createdAt:(0,o.O5)(),lastLogin:(0,o.O5)(),hasSetUsername:!1},{merge:!0})}return t}catch(e){if("auth/popup-blocked"===e.code||"auth/popup-closed-by-user"===e.code||"auth/cancelled-popup-request"===e.code){await (0,n.$2)(l.j2,l.hJ);return}throw e}};return(0,a.jsx)(i.Provider,{value:{user:s,loading:d,signUp:m,signIn:(e,t)=>(0,n.x9)(l.j2,e,t),signInWithGoogle:p,logout:()=>(0,n.CI)(l.j2)},children:t})}},6104:(e,t,s)=>{"use strict";let a;s.d(t,{IG:()=>d,db:()=>c,hJ:()=>u,j2:()=>i});var r=s(3915),n=s(6203),l=s(5317),o=s(858);let i=null,c=null,d=null,u=null;(a=(0,r.Dk)().length?(0,r.Dk)()[0]:(0,r.Wp)({apiKey:"AIzaSyCQf_QXzyZkyRxsbo91PJmdwjEn3lVfDTo",authDomain:"cosmicteams-bbf29.firebaseapp.com",projectId:"cosmicteams-bbf29",storageBucket:"cosmicteams-bbf29.appspot.com",messagingSenderId:"807144888137",appId:"1:807144888137:web:2621a3ac917d9675d6ec98"}))&&(i=(0,n.xI)(a),c=(0,l.aU)(a),d=(0,o.c7)(a),u=new n.HF)},6645:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r}});let a=s(8229)._(s(7357));function r(e,t){var s;let r={};"function"==typeof e&&(r.loader=e);let n={...r,...t};return(0,a.default)({...n,modules:null==(s=n.loadableGenerated)?void 0:s.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},7357:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i}});let a=s(5155),r=s(2115),n=s(2146);function l(e){return{default:e&&"default"in e?e.default:e}}s(255);let o={loader:()=>Promise.resolve(l(()=>null)),loading:null,ssr:!0},i=function(e){let t={...o,...e},s=(0,r.lazy)(()=>t.loader().then(l)),i=t.loading;function c(e){let l=i?(0,a.jsx)(i,{isLoading:!0,pastDelay:!0,error:null}):null,o=!t.ssr||!!t.loading,c=o?r.Suspense:r.Fragment,d=t.ssr?(0,a.jsxs)(a.Fragment,{children:[null,(0,a.jsx)(s,{...e})]}):(0,a.jsx)(n.BailoutToCSR,{reason:"next/dynamic",children:(0,a.jsx)(s,{...e})});return(0,a.jsx)(c,{...o?{fallback:l}:{},children:d})}return c.displayName="LoadableComponent",c}},7828:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorageInstance",{enumerable:!0,get:function(){return a}});let a=(0,s(4054).createAsyncLocalStorage)()},9820:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>m});var a=s(5155),r=s(2115),n=s(5695),l=s(5317),o=s(6104),i=s(5928),c=s(1584),d=s(6766);let u=e=>{let{src:t,alt:s,width:n=100,height:l=100,className:o="",priority:i=!1,loadingStrategy:c="lazy",objectFit:u="cover"}=e,[m,p]=(0,r.useState)(!0),[h,x]=(0,r.useState)(!1),f='\n    <svg width="'.concat(n,'" height="').concat(l,'" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n      <rect width="').concat(n,'" height="').concat(l,'" fill="#1e293b" />\n      <rect id="r" width="').concat(n,'" height="').concat(l,'" fill="url(#g)" />\n      <defs>\n        <linearGradient id="g">\n          <stop stop-color="#1e293b" offset="0%" />\n          <stop stop-color="#334155" offset="50%" />\n          <stop stop-color="#1e293b" offset="100%" />\n        </linearGradient>\n      </defs>\n    </svg>'),b="data:image/svg+xml;base64,".concat(window.btoa(f));return(0,a.jsxs)("div",{className:"relative overflow-hidden ".concat(o),style:{width:n,height:l},children:[m&&(0,a.jsx)("div",{className:"absolute inset-0 bg-slate-800 animate-pulse"}),h?(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-800 text-slate-300 text-sm",children:(0,a.jsx)("span",{children:"Failed to load image"})}):(0,a.jsx)(d.default,{src:t,alt:s,width:n,height:l,onLoad:()=>{p(!1)},onError:()=>{p(!1),x(!0)},priority:i,loading:c,placeholder:"blur",blurDataURL:b,style:{objectFit:u,opacity:+!m,transition:"opacity 0.2s ease-in-out"},className:"w-full h-full"})]})};function m(){let e=(0,n.useRouter)(),{user:t}=(0,i.A)(),[s,d]=(0,r.useState)(!1),[m,p]=(0,r.useState)(!0),[h,x]=(0,r.useState)(""),[f,b]=(0,r.useState)([]),[y,g]=(0,r.useState)(null),[j,v]=(0,r.useState)(""),[N,w]=(0,r.useState)("add"),[k,S]=(0,r.useState)(null),[P,T]=(0,r.useState)([]);(0,r.useEffect)(()=>{(async()=>{if(!t){e.push("/login");return}try{let s=await (0,l.x7)((0,l.H9)(o.db,"users",t.email));if(s.exists()){let a=s.data();if("admin"===a.role){d(!0);let e=(0,l.rJ)(o.db,"tokenTransactions"),s=(0,l.P)(e,(0,l._M)("adminId","==",t.email)),a=await (0,l.GG)(s),r=[];a.forEach(e=>{r.push(e.data())}),r.sort((e,t)=>t.timestamp-e.timestamp),T(r.slice(0,10))}else e.push("/dashboard")}}catch(e){}finally{p(!1)}})()},[t,e]);let _=async()=>{if(h.trim()){p(!0),b([]),g(null);try{let e=(0,l.rJ)(o.db,"users"),t=[];if(h.includes("@")){let e=await (0,l.x7)((0,l.H9)(o.db,"users",h));if(e.exists()){let s=e.data();t.push({uid:e.id,email:e.id,displayName:s.displayName||"Unknown",username:s.username,photoURL:s.photoURL,cosmicTokens:s.cosmicTokens||0})}}else(await (0,l.GG)(e)).forEach(e=>{let s=e.data();s.username&&s.username.toLowerCase().includes(h.toLowerCase())&&t.push({uid:e.id,email:e.id,displayName:s.displayName||"Unknown",username:s.username,photoURL:s.photoURL,cosmicTokens:s.cosmicTokens||0})});b(t)}catch(e){S({text:"Error searching for users. Please try again.",type:"error"})}finally{p(!1)}}},C=e=>{g(e),v(""),S(null)},O=async()=>{if(!y||!j||isNaN(Number(j))){S({text:"Please enter a valid token amount",type:"error"});return}let e=Number(j);if(e<=0){S({text:"Token amount must be greater than 0",type:"error"});return}p(!0);try{let s;let a=(0,l.H9)(o.db,"users",y.email),r=await (0,l.x7)(a);if(!r.exists())throw Error("User not found");let n=r.data().cosmicTokens||0;if("add"===N)s=n+e;else{if(n<e){S({text:"User only has ".concat(n," tokens. Cannot remove ").concat(e," tokens."),type:"error"}),p(!1);return}s=n-e}await (0,l.mZ)(a,{cosmicTokens:s,lastUpdated:Date.now()});let i=(0,l.rJ)(o.db,"tokenTransactions"),c={userId:y.email,username:y.username||y.displayName,adminId:null==t?void 0:t.email,amount:e,type:N,timestamp:Date.now(),previousBalance:n,newBalance:s};await (0,l.mZ)((0,l.H9)(i),c),g({...y,cosmicTokens:s});let d={userId:y.email,username:y.username||y.displayName,amount:e,type:N,timestamp:Date.now()};T([d,...P.slice(0,9)]),S({text:"Successfully ".concat("add"===N?"added":"removed"," ").concat(e," tokens ").concat("add"===N?"to":"from"," ").concat(y.username||y.email),type:"success"}),v("")}catch(e){S({text:"Error processing token transaction. Please try again.",type:"error"})}finally{p(!1)}};return m&&!s?(0,a.jsxs)("main",{className:"min-h-screen flex flex-col",children:[(0,a.jsx)(c.A,{}),(0,a.jsx)("div",{className:"flex-1 py-16 px-6 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"cosmic-card p-8",children:[(0,a.jsx)("div",{className:"animate-spin w-12 h-12 border-4 border-space-cyan border-t-transparent rounded-full mx-auto"}),(0,a.jsx)("p",{className:"text-center mt-4",children:"Loading..."})]})})]}):(0,a.jsxs)("main",{className:"min-h-screen flex flex-col",children:[(0,a.jsx)(c.A,{}),(0,a.jsx)("div",{className:"flex-1 py-8 px-6 max-w-6xl mx-auto w-full",children:(0,a.jsxs)("div",{className:"cosmic-card p-6 mb-8",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Admin Token Management"}),(0,a.jsx)("p",{className:"mb-6 text-gray-300",children:"Grant or remove Cosmic Tokens from users by email or username"}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 mb-8",children:[(0,a.jsx)("input",{type:"text",value:h,onChange:e=>x(e.target.value),onKeyDown:e=>"Enter"===e.key&&_(),placeholder:"Search by email or username",className:"flex-1 bg-space-darker border border-space-indigo rounded-md px-4 py-2 text-white"}),(0,a.jsx)("button",{onClick:_,disabled:m||!h.trim(),className:"btn-primary",children:m?"Searching...":"Search"})]}),f.length>0&&(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Search Results"}),(0,a.jsx)("div",{className:"space-y-4",children:f.map(e=>{var t;return(0,a.jsx)("div",{className:"border p-4 rounded-md cursor-pointer transition-colors ".concat((null==y?void 0:y.email)===e.email?"border-space-gold bg-space-gold/10":"border-space-indigo hover:border-space-cyan"),onClick:()=>C(e),children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[e.photoURL?(0,a.jsx)("div",{className:"w-12 h-12 rounded-full overflow-hidden",children:(0,a.jsx)(u,{src:e.photoURL,alt:e.displayName,width:48,height:48,className:"w-full h-full object-cover"})}):(0,a.jsx)("div",{className:"w-12 h-12 rounded-full bg-space-indigo flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-xl font-bold text-white",children:((null===(t=e.displayName)||void 0===t?void 0:t[0])||e.email[0]).toUpperCase()})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"font-semibold",children:e.displayName}),(0,a.jsx)("p",{className:"text-sm text-gray-300",children:e.username?"@".concat(e.username):""}),(0,a.jsx)("p",{className:"text-sm text-gray-300",children:e.email})]}),(0,a.jsx)("div",{className:"text-right",children:(0,a.jsxs)("div",{className:"font-semibold",children:[e.cosmicTokens," Tokens"]})})]})},e.email)})})]}),y&&(0,a.jsxs)("div",{className:"cosmic-card bg-space-darker p-6 mb-8",children:[(0,a.jsxs)("h2",{className:"text-xl font-semibold mb-4",children:["Modify Tokens for ",y.username||y.email]}),(0,a.jsxs)("p",{className:"mb-4",children:["Current balance: ",(0,a.jsxs)("span",{className:"font-semibold",children:[y.cosmicTokens," Tokens"]})]}),k&&(0,a.jsx)("div",{className:"mb-4 p-3 rounded-md ".concat("success"===k.type?"bg-green-900/50 text-green-300":"bg-red-900/50 text-red-300"),children:k.text}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 mb-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",htmlFor:"token-amount",children:"Token Amount"}),(0,a.jsx)("input",{id:"token-amount",type:"number",min:"1",value:j,onChange:e=>v(e.target.value),placeholder:"Enter amount",className:"w-full bg-space-dark border border-space-indigo rounded-md px-4 py-2 text-white"})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Transaction Type"}),(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"radio",value:"add",checked:"add"===N,onChange:()=>w("add"),className:"form-radio text-space-gold focus:ring-space-gold h-5 w-5"}),(0,a.jsx)("span",{children:"Add Tokens"})]}),(0,a.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"radio",value:"remove",checked:"remove"===N,onChange:()=>w("remove"),className:"form-radio text-red-500 focus:ring-red-500 h-5 w-5"}),(0,a.jsx)("span",{children:"Remove Tokens"})]})]})]})]}),(0,a.jsx)("button",{onClick:O,disabled:m||!j||isNaN(Number(j))||0>=Number(j),className:"px-6 py-2 rounded-md font-medium ".concat("add"===N?"bg-space-gold text-black hover:bg-space-gold/90":"bg-red-600 text-white hover:bg-red-700"),children:m?"Processing...":"add"===N?"Add Tokens":"Remove Tokens"})]}),P.length>0&&(0,a.jsxs)("div",{className:"mt-8",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Recent Transactions"}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-space-indigo",children:[(0,a.jsx)("th",{className:"px-4 py-2 text-left",children:"User"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left",children:"Action"}),(0,a.jsx)("th",{className:"px-4 py-2 text-right",children:"Amount"}),(0,a.jsx)("th",{className:"px-4 py-2 text-right",children:"Date"})]})}),(0,a.jsx)("tbody",{children:P.map((e,t)=>(0,a.jsxs)("tr",{className:"border-b border-space-indigo/30",children:[(0,a.jsx)("td",{className:"px-4 py-3",children:e.username}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat("add"===e.type?"bg-green-900/50 text-green-300":"bg-red-900/50 text-red-300"),children:"add"===e.type?"Added":"Removed"})}),(0,a.jsxs)("td",{className:"px-4 py-3 text-right",children:[e.amount," Tokens"]}),(0,a.jsx)("td",{className:"px-4 py-3 text-right",children:new Date(e.timestamp).toLocaleString()})]},t))})]})})]})]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[611,794,288,766,441,684,358],()=>t(4340)),_N_E=e.O()}]);