(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[662],{255:(e,a,t)=>{"use strict";function s(e){let{moduleIds:a}=e;return null}Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"PreloadChunks",{enumerable:!0,get:function(){return s}}),t(5155),t(7650),t(5744),t(589)},1584:(e,a,t)=>{"use strict";t.d(a,{A:()=>n});var s=t(5155);let r=(0,t(5028).default)(()=>Promise.all([t.e(766),t.e(874),t.e(615)]).then(t.bind(t,4615)),{loadableGenerated:{webpack:()=>[4615]},ssr:!1});function n(){return(0,s.jsx)(r,{})}},2146:(e,a,t)=>{"use strict";function s(e){let{reason:a,children:t}=e;return t}Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"BailoutToCSR",{enumerable:!0,get:function(){return s}}),t(5262)},2608:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>d});var s=t(5155),r=t(2115),n=t(5695),l=t(1584),i=t(5928),o=t(6493);function d(){var e;let a=(0,n.useRouter)(),{user:t}=(0,i.A)(),{profile:d,loading:c,error:u,updateProfileData:m,changePassword:p,changeEmail:h}=(0,o.x)(),[f,b]=(0,r.useState)(""),[x,g]=(0,r.useState)(""),[w,y]=(0,r.useState)(""),[v,j]=(0,r.useState)(""),[N,k]=(0,r.useState)(""),[P,S]=(0,r.useState)(""),[C,U]=(0,r.useState)(""),[L,_]=(0,r.useState)(""),[A,D]=(0,r.useState)(""),[T,E]=(0,r.useState)(""),[R,F]=(0,r.useState)(""),[O,I]=(0,r.useState)(""),[M,B]=(0,r.useState)(!1),[G,q]=(0,r.useState)(!1),[H,J]=(0,r.useState)(!1),[z,W]=(0,r.useState)(""),[X,Z]=(0,r.useState)(!1),[K,Q]=(0,r.useState)(""),[$,V]=(0,r.useState)(""),Y={default:"Default",nebula:"Nebula",aurora:"Aurora",space:"Space",galaxy:"Galaxy","cosmic-stars":"Cosmic Stars","aurora-waves":"Aurora Waves","plasma-field":"Plasma Field","neon-grid":"Neon Grid","galaxy-swirl":"Galaxy Swirl"};(0,r.useEffect)(()=>{t||c||a.push("/login"),(null==d?void 0:d.email)&&j(d.email),(null==d?void 0:d.username)&&S(d.username),(null==d?void 0:d.activeBackground)&&W(d.activeBackground)},[t,c,a,d]);let ee=async e=>{if(e.preventDefault(),U(""),_(""),!f)return U("Current password is required");if(!x)return U("New password is required");if(x.length<6)return U("Password must be at least 6 characters long");if(x!==w)return U("New passwords do not match");B(!0);try{await p(f,x),_("Password changed successfully!"),b(""),g(""),y(""),setTimeout(()=>{_("")},3e3)}catch(e){(null==e?void 0:e.code)==="auth/wrong-password"?U("Current password is incorrect"):(null==e?void 0:e.code)==="auth/weak-password"?U("Password is too weak. Please choose a stronger password."):U("Failed to change password. Please try again.")}finally{B(!1)}},ea=async e=>{if(e.preventDefault(),D(""),E(""),!v)return D("Email is required");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v))return D("Please enter a valid email address");if(!N)return D("Current password is required to change email");if(v===(null==d?void 0:d.email))return D("New email is the same as your current email");q(!0);try{await h(N,v),E("Email changed successfully!"),k(""),setTimeout(()=>{E("")},3e3)}catch(e){(null==e?void 0:e.code)==="auth/wrong-password"?D("Current password is incorrect"):(null==e?void 0:e.code)==="auth/email-already-in-use"?D("This email is already in use by another account"):(null==e?void 0:e.code)==="auth/invalid-email"?D("Please enter a valid email address"):D("Failed to change email. Please try again.")}finally{q(!1)}},et=async e=>{if(e.preventDefault(),F(""),I(""),!P.trim())return F("Username is required");if(!/^[a-zA-Z0-9_]+$/.test(P))return F("Username can only contain letters, numbers, and underscores");if(P===(null==d?void 0:d.username))return F("New username is the same as your current username");J(!0);try{await m({username:P.trim()}),I("Username updated successfully!"),setTimeout(()=>{I("")},3e3)}catch(e){F("Failed to update username. Please try again.")}finally{J(!1)}};return c?(0,s.jsxs)("main",{className:"min-h-screen flex flex-col",children:[(0,s.jsx)(l.A,{}),(0,s.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"cosmic-card p-8",children:[(0,s.jsx)("div",{className:"animate-spin w-12 h-12 border-4 border-space-cyan border-t-transparent rounded-full mx-auto"}),(0,s.jsx)("p",{className:"text-center mt-4 text-white/70",children:"Loading settings..."})]})})]}):(0,s.jsxs)("main",{className:"min-h-screen flex flex-col",children:[(0,s.jsx)(l.A,{}),(0,s.jsx)("div",{className:"flex-1 py-16 px-6",children:(0,s.jsxs)("div",{className:"max-w-3xl mx-auto",children:[(0,s.jsx)("h1",{className:"text-3xl font-space font-bold mb-1 gradient-text cosmic-gradient animate-fade-in-up",style:{animationDelay:"100ms"},children:"Account Settings"}),(0,s.jsx)("p",{className:"text-white/70 mb-8 animate-fade-in-up",style:{animationDelay:"150ms"},children:"Manage your account security and preferences"}),u&&(0,s.jsx)("div",{className:"bg-yellow-500/20 border border-yellow-500/50 text-white p-4 rounded-lg mb-6",children:u}),(0,s.jsxs)("div",{className:"cosmic-card mb-8 animate-fade-in-up",style:{animationDelay:"200ms"},children:[(0,s.jsx)("h2",{className:"text-xl font-space font-bold mb-4 text-space-cyan",children:"Change Password"}),C&&(0,s.jsx)("div",{className:"bg-red-500/20 border border-red-500/50 text-white p-3 rounded-lg mb-4 animate-shake",children:C}),L&&(0,s.jsx)("div",{className:"bg-green-500/20 border border-green-500/50 text-white p-3 rounded-lg mb-4 animate-fade-in-up",children:L}),(0,s.jsxs)("form",{onSubmit:ee,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"currentPassword",className:"block text-sm font-medium mb-1",children:"Current Password"}),(0,s.jsx)("input",{id:"currentPassword",type:"password",value:f,onChange:e=>b(e.target.value),className:"cosmic-input w-full focus:cosmic-glow-input",placeholder:"••••••••"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"newPassword",className:"block text-sm font-medium mb-1",children:"New Password"}),(0,s.jsx)("input",{id:"newPassword",type:"password",value:x,onChange:e=>g(e.target.value),className:"cosmic-input w-full focus:cosmic-glow-input",placeholder:"••••••••"}),(0,s.jsx)("p",{className:"mt-1 text-xs text-white/60",children:"Must be at least 6 characters long"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium mb-1",children:"Confirm New Password"}),(0,s.jsx)("input",{id:"confirmPassword",type:"password",value:w,onChange:e=>y(e.target.value),className:"cosmic-input w-full focus:cosmic-glow-input",placeholder:"••••••••"})]}),(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsx)("button",{type:"submit",disabled:M,className:"btn-gradient flex items-center space-x-2",children:M?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"inline-block h-4 w-4 animate-spin rounded-full border-2 border-solid border-current border-r-transparent"}),(0,s.jsx)("span",{children:"Updating..."})]}):(0,s.jsx)("span",{children:"Update Password"})})})]})]}),(0,s.jsxs)("div",{className:"cosmic-card animate-fade-in-up",style:{animationDelay:"300ms"},children:[(0,s.jsx)("h2",{className:"text-xl font-space font-bold mb-4 text-space-cyan",children:"Change Email"}),A&&(0,s.jsx)("div",{className:"bg-red-500/20 border border-red-500/50 text-white p-3 rounded-lg mb-4 animate-shake",children:A}),T&&(0,s.jsx)("div",{className:"bg-green-500/20 border border-green-500/50 text-white p-3 rounded-lg mb-4 animate-fade-in-up",children:T}),(0,s.jsxs)("form",{onSubmit:ea,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"newEmail",className:"block text-sm font-medium mb-1",children:"New Email Address"}),(0,s.jsx)("input",{id:"newEmail",type:"email",value:v,onChange:e=>j(e.target.value),className:"cosmic-input w-full focus:cosmic-glow-input",placeholder:"your@email.com"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"emailCurrentPassword",className:"block text-sm font-medium mb-1",children:"Current Password"}),(0,s.jsx)("input",{id:"emailCurrentPassword",type:"password",value:N,onChange:e=>k(e.target.value),className:"cosmic-input w-full focus:cosmic-glow-input",placeholder:"••••••••"}),(0,s.jsx)("p",{className:"mt-1 text-xs text-white/60",children:"For security, please enter your current password to change your email"})]}),(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsx)("button",{type:"submit",disabled:G,className:"btn-gradient flex items-center space-x-2",children:G?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"inline-block h-4 w-4 animate-spin rounded-full border-2 border-solid border-current border-r-transparent"}),(0,s.jsx)("span",{children:"Updating..."})]}):(0,s.jsx)("span",{children:"Update Email"})})})]})]}),(0,s.jsxs)("div",{className:"cosmic-card mb-8 animate-fade-in-up",style:{animationDelay:"350ms"},children:[(0,s.jsx)("h2",{className:"text-xl font-space font-bold mb-4 text-space-cyan",children:"Profile Background"}),$&&(0,s.jsx)("div",{className:"bg-red-500/20 border border-red-500/50 text-white p-3 rounded-lg mb-4 animate-shake",children:$}),K&&(0,s.jsx)("div",{className:"bg-green-500/20 border border-green-500/50 text-white p-3 rounded-lg mb-4 animate-fade-in-up",children:K}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("p",{className:"text-sm text-white/70 mb-2",children:"Select a background to use on your profile. You can acquire more backgrounds from the marketplace."}),(0,s.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 mt-4",children:[(0,s.jsx)("div",{className:"relative overflow-hidden rounded-lg cursor-pointer border-2 transition-all ".concat("default"!==z&&z?"border-transparent hover:border-white/30":"border-space-gold"),onClick:()=>W("default"),children:(0,s.jsx)("div",{className:"aspect-video bg-gradient-to-br from-space-indigo to-space-purple relative overflow-hidden",children:(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center text-white text-xs font-medium",children:"Default"})})}),null==d?void 0:null===(e=d.backgrounds)||void 0===e?void 0:e.map(e=>{let a=e.replace("background-",""),t=Y[a]||a;return(0,s.jsx)("div",{className:"relative overflow-hidden rounded-lg cursor-pointer border-2 transition-all ".concat(z===e?"border-space-gold":"border-transparent hover:border-white/30"),onClick:()=>W(e),children:(0,s.jsxs)("div",{className:"\n                        aspect-video relative overflow-hidden\n                        ".concat("nebula"===a?"bg-gradient-to-br from-purple-900 via-indigo-800 to-blue-900":"","\n                        ").concat("aurora"===a?"bg-gradient-to-r from-green-400 to-blue-500 animate-pulse-slow":"","\n                        ").concat("space"===a?"bg-black cosmic-stars":"","\n                        ").concat("galaxy"===a?"bg-gradient-to-r from-purple-500 via-pink-500 to-red-500 bg-size-200 animate-gradient-x":"","\n                        ").concat("cosmic-stars"===a?"bg-space-dark":"","\n                        ").concat("aurora-waves"===a?"bg-indigo-900":"","\n                        ").concat("plasma-field"===a?"bg-space-dark":"","\n                        ").concat("neon-grid"===a?"bg-black":"","\n                        ").concat("galaxy-swirl"===a?"bg-space-dark":"","\n                      "),children:[(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center text-white text-xs font-medium",children:t}),"cosmic-stars"===a&&(0,s.jsx)("div",{className:"absolute inset-0 pointer-events-none cosmic-stars-bg"}),"aurora-waves"===a&&(0,s.jsxs)("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:[(0,s.jsx)("div",{className:"absolute w-[200%] h-[5px] top-[20%] bg-gradient-to-r from-green-500/0 via-green-500/50 to-green-500/0 animate-aurora-shift"}),(0,s.jsx)("div",{className:"absolute w-[200%] h-[5px] top-[50%] bg-gradient-to-r from-blue-500/0 via-blue-500/50 to-blue-500/0 animate-aurora-shift-delay"}),(0,s.jsx)("div",{className:"absolute w-[200%] h-[5px] top-[80%] bg-gradient-to-r from-purple-500/0 via-purple-500/50 to-purple-500/0 animate-aurora-shift-delay-2"})]}),"neon-grid"===a&&(0,s.jsxs)("div",{className:"absolute inset-0 pointer-events-none",children:[Array.from({length:3}).map((e,a)=>(0,s.jsx)("div",{className:"absolute h-[1px] w-full bg-space-indigo shadow-glow animate-neon-pulse",style:{top:"".concat(50*a,"%"),animationDelay:"".concat(.2*a,"s")}},"h".concat(a))),Array.from({length:3}).map((e,a)=>(0,s.jsx)("div",{className:"absolute w-[1px] h-full bg-space-indigo shadow-glow animate-neon-pulse",style:{left:"".concat(50*a,"%"),animationDelay:"".concat(.2*a+.1,"s")}},"v".concat(a)))]})]})},e)}),(0,s.jsx)("div",{className:"relative overflow-hidden rounded-lg cursor-pointer border-2 border-dashed border-white/30 hover:border-white/50 transition-all",onClick:()=>a.push("/marketplace?category=background"),children:(0,s.jsx)("div",{className:"aspect-video flex items-center justify-center text-white text-xs",children:(0,s.jsxs)("span",{className:"flex items-center",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Get More"]})})})]})]}),(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsx)("button",{onClick:async()=>{try{Z(!0),V(""),Q(""),await m({activeBackground:z||"default"}),Q("Background updated successfully!"),setTimeout(()=>{Q("")},3e3)}catch(e){V("Failed to update background. Please try again.")}finally{Z(!1)}},disabled:X,className:"btn-gradient flex items-center space-x-2",children:X?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"inline-block h-4 w-4 animate-spin rounded-full border-2 border-solid border-current border-r-transparent"}),(0,s.jsx)("span",{children:"Applying..."})]}):(0,s.jsx)("span",{children:"Apply Background"})})})]}),(0,s.jsxs)("div",{className:"cosmic-card animate-fade-in-up",style:{animationDelay:"350ms"},children:[(0,s.jsx)("h2",{className:"text-xl font-space font-bold mb-4 text-space-cyan",children:"Change Username"}),R&&(0,s.jsx)("div",{className:"bg-red-500/20 border border-red-500/50 text-white p-3 rounded-lg mb-4 animate-shake",children:R}),O&&(0,s.jsx)("div",{className:"bg-green-500/20 border border-green-500/50 text-white p-3 rounded-lg mb-4 animate-fade-in-up",children:O}),(0,s.jsxs)("form",{onSubmit:et,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"username",className:"block text-sm font-medium mb-1",children:"New Username"}),(0,s.jsx)("input",{id:"username",type:"text",value:P,onChange:e=>S(e.target.value),className:"cosmic-input w-full focus:cosmic-glow-input",placeholder:"your_username"}),(0,s.jsx)("p",{className:"mt-1 text-xs text-white/60",children:"Can only contain letters, numbers, and underscores"})]}),(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsx)("button",{type:"submit",disabled:H,className:"btn-gradient flex items-center space-x-2",children:H?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"inline-block h-4 w-4 animate-spin rounded-full border-2 border-solid border-current border-r-transparent"}),(0,s.jsx)("span",{children:"Updating..."})]}):(0,s.jsx)("span",{children:"Update Username"})})})]})]}),(0,s.jsxs)("div",{className:"mt-8 text-white/70 text-sm text-center animate-fade-in-up",style:{animationDelay:"400ms"},children:[(0,s.jsxs)("p",{children:["Account created: ",(null==d?void 0:d.createdAt)?new Date(d.createdAt).toLocaleDateString():"Unknown"]}),(0,s.jsxs)("p",{children:["Last updated: ",(null==d?void 0:d.lastUpdated)?new Date(d.lastUpdated).toLocaleDateString():"Unknown"]})]})]})})]})}},4054:(e,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),!function(e,a){for(var t in a)Object.defineProperty(e,t,{enumerable:!0,get:a[t]})}(a,{bindSnapshot:function(){return l},createAsyncLocalStorage:function(){return n},createSnapshot:function(){return i}});let t=Object.defineProperty(Error("Invariant: AsyncLocalStorage accessed in runtime where it is not available"),"__NEXT_ERROR_CODE",{value:"E504",enumerable:!1,configurable:!0});class s{disable(){throw t}getStore(){}run(){throw t}exit(){throw t}enterWith(){throw t}static bind(e){return e}}let r="undefined"!=typeof globalThis&&globalThis.AsyncLocalStorage;function n(){return r?new r:new s}function l(e){return r?r.bind(e):s.bind(e)}function i(){return r?r.snapshot():function(e,...a){return e(...a)}}},5028:(e,a,t)=>{"use strict";t.d(a,{default:()=>r.a});var s=t(6645),r=t.n(s)},5695:(e,a,t)=>{"use strict";var s=t(8999);t.o(s,"usePathname")&&t.d(a,{usePathname:function(){return s.usePathname}}),t.o(s,"useRouter")&&t.d(a,{useRouter:function(){return s.useRouter}})},5744:(e,a,t)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"workAsyncStorage",{enumerable:!0,get:function(){return s.workAsyncStorageInstance}});let s=t(7828)},5928:(e,a,t)=>{"use strict";t.d(a,{A:()=>d,O:()=>c});var s=t(5155),r=t(2115),n=t(3004),l=t(6104),i=t(5317);let o=(0,r.createContext)(null);function d(){let e=(0,r.useContext)(o);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}function c(e){let{children:a}=e,[t,d]=(0,r.useState)(null),[c,u]=(0,r.useState)(!0);(0,r.useEffect)(()=>{let e=(0,n.hg)(l.j2,e=>{d(e),u(!1)});return(0,n.Q4)(l.j2).then(e=>{(null==e?void 0:e.user)&&d(e.user)}).catch(e=>{}),e},[]);let m=async(e,a,t)=>{let s=await (0,n.eJ)(l.j2,e,a),r=s.user;return t&&r&&(await (0,n.r7)(r,{displayName:t}),await (0,i.BN)((0,i.H9)(l.db,"userProfiles",r.uid),{email:r.email,username:t,displayName:t,createdAt:(0,i.O5)(),hasSetUsername:!0})),s},p=async()=>{try{l.hJ.setCustomParameters({prompt:"select_account"});let a=await (0,n.df)(l.j2,l.hJ,n.hk),t=a.user;if(t){var e;await (0,i.BN)((0,i.H9)(l.db,"userProfiles",t.uid),{email:t.email,displayName:t.displayName||(null===(e=t.email)||void 0===e?void 0:e.split("@")[0])||"User",photoURL:t.photoURL,createdAt:(0,i.O5)(),lastLogin:(0,i.O5)(),hasSetUsername:!1},{merge:!0})}return a}catch(e){if("auth/popup-blocked"===e.code||"auth/popup-closed-by-user"===e.code||"auth/cancelled-popup-request"===e.code){await (0,n.$2)(l.j2,l.hJ);return}throw e}};return(0,s.jsx)(o.Provider,{value:{user:t,loading:c,signUp:m,signIn:(e,a)=>(0,n.x9)(l.j2,e,a),signInWithGoogle:p,logout:()=>(0,n.CI)(l.j2)},children:a})}},6104:(e,a,t)=>{"use strict";let s;t.d(a,{IG:()=>c,db:()=>d,hJ:()=>u,j2:()=>o});var r=t(3915),n=t(3004),l=t(5317),i=t(858);let o=null,d=null,c=null,u=null;(s=(0,r.Dk)().length?(0,r.Dk)()[0]:(0,r.Wp)({apiKey:"AIzaSyCQf_QXzyZkyRxsbo91PJmdwjEn3lVfDTo",authDomain:"cosmicteams-bbf29.firebaseapp.com",projectId:"cosmicteams-bbf29",storageBucket:"cosmicteams-bbf29.appspot.com",messagingSenderId:"807144888137",appId:"1:807144888137:web:2621a3ac917d9675d6ec98"}))&&(o=(0,n.xI)(s),d=(0,l.aU)(s),c=(0,i.c7)(s),u=new n.HF)},6325:(e,a,t)=>{Promise.resolve().then(t.bind(t,2608))},6493:(e,a,t)=>{"use strict";t.d(a,{H:()=>m,x:()=>u});var s=t(5155),r=t(2115),n=t(5317),l=t(3004),i=t(858),o=t(6104),d=t(5928);let c=(0,r.createContext)(null);function u(){let e=(0,r.useContext)(c);if(!e)throw Error("useProfile must be used within a ProfileProvider");return e}function m(e){let{children:a}=e,{user:t}=(0,d.A)(),[u,m]=(0,r.useState)(null),[p,h]=(0,r.useState)(!0),[f,b]=(0,r.useState)(!1),[x,g]=(0,r.useState)(null);(0,r.useEffect)(()=>{!async function(){if(!t){m(null),h(!1);return}h(!0);try{let e={displayName:t.displayName||"",photoURL:t.photoURL||"",email:t.email||"",username:t.email?t.email.split("@")[0]:"",profileMusic:null,musicType:null,gameTiers:{"neth-op":"LT1",axe:"LT1",smp:"LT1",cpvp:"LT1",sword:"LT1",uhc:"LT1"},canCreateTeams:!0,lastUpdated:Date.now(),createdAt:Date.now(),cosmicTokens:100,spinnerUsed:0,lastSpinTime:0};if(t.uid&&o.db){let a=(0,n.H9)(o.db,"userProfiles",t.uid),s=await (0,n.x7)(a);s.exists()?m({...e,...s.data()}):(await (0,n.BN)(a,{...e,createdAt:Date.now(),lastUpdated:Date.now()}),m(e))}else m(e)}catch(e){g("Failed to load profile data"),t&&m({displayName:t.displayName||"",photoURL:t.photoURL||"",email:t.email||"",username:t.email?t.email.split("@")[0]:"",profileMusic:null,musicType:null})}finally{h(!1)}}()},[t,o.db]);let w=async e=>{if(t){b(!0),g(null);try{if(e.displayName||e.photoURL){let a={};e.displayName&&(a.displayName=e.displayName),e.photoURL&&(a.photoURL=e.photoURL),await (0,l.r7)(t,a)}if(void 0!==e.cosmicTokens){if(e.cosmicTokens<0)throw Error("Token amount cannot be negative");e.cosmicTokens=Number(e.cosmicTokens)}if(t.uid&&o.db){let a=(0,n.H9)(o.db,"userProfiles",t.uid),s={...e,lastUpdated:Date.now()};await (0,n.mZ)(a,s);let r=(await (0,n.x7)(a)).data();m(e=>e?{...e,...r}:null)}else m(a=>a?{...a,...e}:null)}catch(e){throw g("Failed to update profile"),e}finally{b(!1)}}},y=async e=>{if(!t)throw Error("User not authenticated");b(!0),g(null);try{if(e.size>2097152)throw Error("Image file is too large. Please select a file under 2MB.");if(!e.type.startsWith("image/"))throw Error("Please select a valid image file (JPG, PNG, etc.)");let a=(0,i.KR)(o.IG,"profile-images/".concat(t.uid,"/").concat(Date.now(),"-").concat(e.name));if((null==u?void 0:u.photoURL)&&u.photoURL.includes("firebasestorage.googleapis.com"))try{let e=(0,i.KR)(o.IG,u.photoURL);await (0,i.XR)(e)}catch(e){}await (0,i.D)(a,e);let s=await (0,i.qk)(a);return await w({photoURL:s}),s}catch(e){throw g(e instanceof Error?e.message:"Failed to upload profile image"),e}finally{b(!1)}},v=async e=>{if(t){b(!0),g(null);try{t.uid&&await w({gameTiers:e})}catch(e){throw g("Failed to update game tiers"),e}finally{b(!1)}}},j=async(e,a)=>{if(!t||!t.email)throw Error("User not authenticated or email not available");b(!0),g(null);try{let s=l.IX.credential(t.email,e);await (0,l.kZ)(t,s),await (0,l.f3)(t,a)}catch(e){throw"auth/wrong-password"===e.code?g("Current password is incorrect"):g("Failed to change password"),e}finally{b(!1)}},N=async(e,a)=>{if(!t||!t.email)throw Error("User not authenticated or email not available");b(!0),g(null);try{let s=l.IX.credential(t.email,e);await (0,l.kZ)(t,s),await (0,l.Ww)(t,a),await w({email:a})}catch(e){throw"auth/wrong-password"===e.code?g("Current password is incorrect"):"auth/email-already-in-use"===e.code?g("This email is already in use by another account"):g("Failed to change email"),e}finally{b(!1)}};return(0,s.jsx)(c.Provider,{value:{profile:u,loading:p,updating:f,error:x,updateProfileData:w,uploadProfileImage:y,changePassword:j,changeEmail:N,updateAllGameTiers:v},children:a})}},6645:(e,a,t)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"default",{enumerable:!0,get:function(){return r}});let s=t(8229)._(t(7357));function r(e,a){var t;let r={};"function"==typeof e&&(r.loader=e);let n={...r,...a};return(0,s.default)({...n,modules:null==(t=n.loadableGenerated)?void 0:t.modules})}("function"==typeof a.default||"object"==typeof a.default&&null!==a.default)&&void 0===a.default.__esModule&&(Object.defineProperty(a.default,"__esModule",{value:!0}),Object.assign(a.default,a),e.exports=a.default)},7357:(e,a,t)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"default",{enumerable:!0,get:function(){return o}});let s=t(5155),r=t(2115),n=t(2146);function l(e){return{default:e&&"default"in e?e.default:e}}t(255);let i={loader:()=>Promise.resolve(l(()=>null)),loading:null,ssr:!0},o=function(e){let a={...i,...e},t=(0,r.lazy)(()=>a.loader().then(l)),o=a.loading;function d(e){let l=o?(0,s.jsx)(o,{isLoading:!0,pastDelay:!0,error:null}):null,i=!a.ssr||!!a.loading,d=i?r.Suspense:r.Fragment,c=a.ssr?(0,s.jsxs)(s.Fragment,{children:[null,(0,s.jsx)(t,{...e})]}):(0,s.jsx)(n.BailoutToCSR,{reason:"next/dynamic",children:(0,s.jsx)(t,{...e})});return(0,s.jsx)(d,{...i?{fallback:l}:{},children:c})}return d.displayName="LoadableComponent",d}},7828:(e,a,t)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"workAsyncStorageInstance",{enumerable:!0,get:function(){return s}});let s=(0,t(4054).createAsyncLocalStorage)()}},e=>{var a=a=>e(e.s=a);e.O(0,[611,416,835,441,684,358],()=>a(6325)),_N_E=e.O()}]);